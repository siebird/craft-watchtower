{% extends 'watchtower/_layouts/base' %}
{% set selectedSubnavItem = 'settings' %}
{% set title  = "General Settings"|t('watchtower') %}
{% set fullPageForm = true %}

{% macro errorList(errors) %}
    {% if errors %}
        <ul class="errors">
            {% for categorizedErrors in errors %}
                {% for error in categorizedErrors %}
                    <li>{{ error }}</li>
                {% endfor %}
            {% endfor %}
        </ul>
    {% endif %}
{% endmacro %}
{% from _self import errorList %}

{% import "_includes/forms" as forms %}
{% block content %}
	<div id="settings-cp">
		{% if errors is defined and errors|length %}
		    <div class="pane">
		        <h3>{{ "Something went wrong!"|t('watchtower') }}</h3>
		        {{ errorList(errors) }}
		    </div>
		    <br>
		{% endif %}

	    {{ csrfInput() }}
	    <input type="hidden" name="action" value="{{ meta.action }}">
	    {{ redirectInput("watchtower/settings") }}

		{% namespace 'settings' %}
			{{ forms.textField({
			    first: true,
			    label: "Plugin Name"|t('watchtower'),
			    name: 'pluginName',
			    value: settings.pluginName,
			    required: true,
			    errors: (settings is defined ? settings.getErrors('pluginName') : null),
			}) }}

			<hr>

			{{ forms.textField({
			    first: true,
			    label: "Queue Pileup Limit"|t('watchtower'),
			    instructions: "Limit the number of pending queues on you want to get notified."|t('watchtower'),
			    name: 'pileUpQueueLimit',
			    value: settings.pileUpQueueLimit,
			    size: 3,
			    inputmode: 'numeric',
			    required: true,
			    errors: (settings is defined ? settings.getErrors('pileUpQueueLimit') : null),
			}) }}

			{{ forms.textField({
			    first: true,
			    label: "Queue Failed Limit"|t('watchtower'),
			    instructions: "Limit the number of failed queues on you want to get notified."|t('watchtower'),
			    name: 'failedQueueLimit',
			    value: settings.failedQueueLimit,
			    size: 3,
			    inputmode: 'numeric',
			    required: true,
			    errors: (settings is defined ? settings.getErrors('failedQueueLimit') : null),
			}) }}

			{{ forms.lightswitchField({
                label: 'Ignore Repeated'|t('watchtower'),
			    instructions: "dont include such queues in calculation which are same queue multiple time. (e.g., Updating search indexes)"|t('watchtower'),
                id: 'ignoreRepeated',
                name: 'ignoreRepeated',
                on: settings.ignoreRepeated,
                onLabel: "Yes",
                offLabel: "No"
            }) }}

			{{ forms.textField({
			    first: true,
			    label: "Email Addresses"|t('watchtower'),
			    instructions: "Comma seperated emails where we will notify uncommon queue behaviour"|t('watchtower'),
			    name: 'emails',
			    value: settings.emails,
			    required: true,
			    errors: (settings is defined ? settings.getErrors('emails') : null),
			}) }}

			{{ forms.autosuggestField({
			    label: "Override Email Template"|t('watchtower'),
			    instructions: "If you wish to trigger your own custom email template, You can select that template here.(Default email template in plugin's templates folder can be a good example to start with.)"|t('watchtower'),
			    id: 'overrideEmailTemplate',
			    name: 'overrideEmailTemplate',
			    suggestions: craft.cp.getTemplateSuggestions(),
			    required: false,
			    value: settings.overrideEmailTemplate,
			    errors: (settings is defined ? settings.getErrors('overrideEmailTemplate') : null),
			}) }}

			<hr>
			{{ forms.textField({
			    first: true,
			    label: "Oh Dear ping URL"|t('watchtower'),
			    instructions: "Generate a ping with <a href='https://ohdear.app/' target='_blank'>Oh Dear</a> ?"|t('watchtower'),
			    name: 'ohDearPingUrl',
			    value: settings.ohDearPingUrl,
			    required: false,
			    errors: (settings is defined ? settings.getErrors('ohDearPingUrl') : null),
			}) }}
		{% endnamespace %}

		<button class="btn submit" type="submit">{{ 'Save'|t('watchtower') }}</button>
    </div>
{% endblock %}